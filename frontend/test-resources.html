<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èµ„æºæ˜¾ç¤ºæµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 40px;
        }
        .test-card {
            background: #16213e;
            padding: 30px;
            margin: 20px 0;
            border-radius: 12px;
            border: 1px solid #667eea;
        }
        h2 {
            color: #f093fb;
            margin-top: 0;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .resource-list {
            list-style: none;
            padding: 0;
        }
        .resource-item {
            background: #0f172a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #4ade80;
        }
        .resource-item a {
            color: #4ade80;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .resource-item a:hover {
            color: #6ee7b7;
        }
        .icon {
            font-size: 1.5rem;
        }
        pre {
            background: #0f172a;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            color: #a5f3fc;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin: 10px 0;
        }
        .status.success {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
            border: 1px solid #4ade80;
        }
        .status.error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid #ef4444;
        }
        .btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .btn:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <h1>ğŸ” èµ„æºæ˜¾ç¤ºæµ‹è¯•é¡µé¢</h1>

    <div class="test-card">
        <h2>æµ‹è¯•1: å­—ç¬¦ä¸²URLæ•°ç»„ï¼ˆåç«¯åŸå§‹æ ¼å¼ï¼‰</h2>
        <p>æ¨¡æ‹Ÿä» <code>majors_latest.json</code> è¯»å–çš„æ•°æ®æ ¼å¼</p>
        <pre id="test1-input"></pre>
        <button class="btn" onclick="runTest1()">è¿è¡Œæµ‹è¯•</button>
        <div id="test1-result"></div>
    </div>

    <div class="test-card">
        <h2>æµ‹è¯•2: å¯¹è±¡æ•°ç»„ï¼ˆAPIè½¬æ¢åæ ¼å¼ï¼‰</h2>
        <p>æ¨¡æ‹ŸAPI endpointè½¬æ¢åçš„æ•°æ®æ ¼å¼</p>
        <pre id="test2-input"></pre>
        <button class="btn" onclick="runTest2()">è¿è¡Œæµ‹è¯•</button>
        <div id="test2-result"></div>
    </div>

    <div class="test-card">
        <h2>æµ‹è¯•3: å®Œæ•´APIè°ƒç”¨</h2>
        <p>æµ‹è¯•å®é™…APIè°ƒç”¨å’Œèµ„æºæ˜¾ç¤º</p>
        <button class="btn" onclick="testAPI()">è°ƒç”¨ /api/major-research</button>
        <div id="api-status"></div>
        <pre id="api-result"></pre>
    </div>

    <script>
        // å·¥å…·å‡½æ•°ï¼šä»URLæå–æ ‡é¢˜
        function extractTitle(url, index) {
            try {
                const urlObj = new URL(url);
                let hostname = urlObj.hostname.replace('www.', '').replace('m.', '');
                
                // æ ¹æ®åŸŸååˆ¤æ–­ç±»å‹
                if (hostname.includes('youtube') || hostname.includes('youtu.be')) {
                    return { title: `YouTube: ${hostname}`, type: 'video', icon: 'ğŸ¥' };
                } else if (hostname.includes('medium') || hostname.includes('blog')) {
                    return { title: `æ–‡ç« : ${hostname}`, type: 'article', icon: 'ğŸ“„' };
                } else if (hostname.includes('coursera') || hostname.includes('udemy') || hostname.includes('edu')) {
                    return { title: `è¯¾ç¨‹: ${hostname}`, type: 'course', icon: 'ğŸ“' };
                } else if (hostname.includes('reddit') || hostname.includes('forum')) {
                    return { title: `è®ºå›: ${hostname}`, type: 'website', icon: 'ğŸ’¬' };
                } else {
                    return { title: hostname, type: 'website', icon: 'ğŸŒ' };
                }
            } catch (e) {
                return { title: `èµ„æº ${index + 1}`, type: 'website', icon: 'ğŸ”—' };
            }
        }

        // æµ‹è¯•1: å­—ç¬¦ä¸²URLæ•°ç»„
        function runTest1() {
            const testData = [
                "https://m.youtube.com/watch?v=QyiVCk8BRZ4",
                "https://www.reddit.com/r/csMajors/comments/w35px0/",
                "https://medium.com/@Arashhadad/what-you-can-expect",
                "https://www.cs.columbia.edu/education/undergraduate/",
                "https://www.coursera.org/articles/data-science-major"
            ];

            document.getElementById('test1-input').textContent = JSON.stringify(testData, null, 2);

            let html = '<div class="status success">âœ… è½¬æ¢æˆåŠŸ</div><ul class="resource-list">';
            
            testData.forEach((url, index) => {
                const { title, type, icon } = extractTitle(url, index);
                html += `
                    <li class="resource-item">
                        <a href="${url}" target="_blank">
                            <span class="icon">${icon}</span>
                            <span>${title}</span>
                        </a>
                    </li>
                `;
            });
            
            html += '</ul>';
            document.getElementById('test1-result').innerHTML = html;
        }

        // æµ‹è¯•2: å¯¹è±¡æ•°ç»„
        function runTest2() {
            const testData = [
                { title: "MITè®¡ç®—æœºç§‘å­¦è¯¾ç¨‹", url: "https://ocw.mit.edu/courses/", type: "course" },
                { title: "ç®—æ³•å¯¼è®º", url: "https://mitpress.mit.edu/books/introduction-algorithms", type: "book" },
                { title: "Kaggleæ•°æ®ç§‘å­¦è¯¾ç¨‹", url: "https://www.kaggle.com/learn", type: "course" }
            ];

            document.getElementById('test2-input').textContent = JSON.stringify(testData, null, 2);

            const iconMap = {
                video: 'ğŸ¥',
                article: 'ğŸ“„',
                course: 'ğŸ“',
                book: 'ğŸ“š',
                website: 'ğŸŒ'
            };

            let html = '<div class="status success">âœ… æ ¼å¼æ­£ç¡®</div><ul class="resource-list">';
            
            testData.forEach(resource => {
                const icon = iconMap[resource.type] || 'ğŸ”—';
                html += `
                    <li class="resource-item">
                        <a href="${resource.url}" target="_blank">
                            <span class="icon">${icon}</span>
                            <span>${resource.title}</span>
                        </a>
                    </li>
                `;
            });
            
            html += '</ul>';
            document.getElementById('test2-result').innerHTML = html;
        }

        // æµ‹è¯•3: APIè°ƒç”¨
        async function testAPI() {
            const statusDiv = document.getElementById('api-status');
            const resultDiv = document.getElementById('api-result');
            
            statusDiv.innerHTML = '<div class="status">â³ æ­£åœ¨è°ƒç”¨API...</div>';
            resultDiv.textContent = '';

            try {
                const response = await fetch('http://localhost:5000/api/major-research', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: "æˆ‘å–œæ¬¢ç¼–ç¨‹å’Œæ•°å­¦" })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                
                if (data.success && data.majors && data.majors.length > 0) {
                    statusDiv.innerHTML = '<div class="status success">âœ… APIè°ƒç”¨æˆåŠŸ</div>';
                    
                    // æ˜¾ç¤ºç¬¬ä¸€ä¸ªä¸“ä¸šçš„èµ„æº
                    const firstMajor = data.majors[0];
                    resultDiv.textContent = JSON.stringify({
                        major: firstMajor.name,
                        resources: firstMajor.resources
                    }, null, 2);

                    // æ˜¾ç¤ºèµ„æºåˆ—è¡¨
                    if (firstMajor.resources && firstMajor.resources.length > 0) {
                        const iconMap = {
                            video: 'ğŸ¥',
                            article: 'ğŸ“„',
                            course: 'ğŸ“',
                            book: 'ğŸ“š',
                            website: 'ğŸŒ'
                        };

                        let html = '<h3 style="color: #4ade80; margin-top: 20px;">èµ„æºåˆ—è¡¨:</h3><ul class="resource-list">';
                        
                        firstMajor.resources.forEach(resource => {
                            const icon = iconMap[resource.type] || 'ğŸ”—';
                            html += `
                                <li class="resource-item">
                                    <a href="${resource.url}" target="_blank">
                                        <span class="icon">${icon}</span>
                                        <span>${resource.title}</span>
                                    </a>
                                </li>
                            `;
                        });
                        
                        html += '</ul>';
                        statusDiv.innerHTML += html;
                    }
                } else {
                    throw new Error('APIè¿”å›æ ¼å¼é”™è¯¯');
                }

            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ é”™è¯¯: ${error.message}</div>`;
                resultDiv.textContent = error.stack || error.message;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•1å’Œ2
        window.onload = () => {
            runTest1();
            runTest2();
        };
    </script>
</body>
</html>
